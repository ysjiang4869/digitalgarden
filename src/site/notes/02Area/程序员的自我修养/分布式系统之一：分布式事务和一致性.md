---
{"dg-publish":true,"dg-permalink":"distributed-system-transaction-and-consistency","permalink":"/distributed-system-transaction-and-consistency/","title":"äº‹åŠ¡å’ŒACID","tags":["åˆ†å¸ƒå¼","WLB"],"created":"2021-05-18 16:00","updated":"2024-08-18 20:12"}
---


åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¾€å¾€ä¸€ä¸ªä¸šåŠ¡çš„å®Œæˆï¼Œéœ€è¦æ‰§è¡Œå¤šæ¬¡æ“ä½œï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›æ“ä½œæ˜¯å¯ä»¥å…¨éƒ¨æˆåŠŸï¼Œæˆ–è€…å…¨éƒ¨å¤±è´¥ï¼Œè€Œä¸æ˜¯åœæ­¢åœ¨ä¸€åŠï¼Œè¿™å°±æ¶‰åŠåˆ°äº‹åŠ¡çš„æ¦‚å¿µã€‚

# äº‹åŠ¡å’ŒACID

äº‹åŠ¡æ˜¯åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤æ¶ˆã€‚ä¹Ÿå°±æ˜¯äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åšã€‚äº‹åŠ¡åº”è¯¥å…·æœ‰ 4 ä¸ªå±æ€§ï¼š

> åŸå­æ€§ï¼ˆatomicityï¼Œæˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆisolationï¼Œåˆç§°ç‹¬ç«‹æ€§ï¼‰ã€æŒä¹…æ€§ï¼ˆdurabilityï¼‰ã€‚

è¿™å››ä¸ªå±æ€§é€šå¸¸ç§°ä¸º ACID ç‰¹æ€§ã€‚

- Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«[å›æ»š](https://zh.wikipedia.org/wiki/%E5%9B%9E%E6%BB%9A_(%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86))ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚
- Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾[çº¦æŸ](https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7)ã€[è§¦å‘å™¨](https://zh.wikipedia.org/wiki/%E8%A7%A6%E5%8F%91%E5%99%A8_(%E6%95%B0%E6%8D%AE%E5%BA%93))ã€[çº§è”å›æ»š](https://zh.wikipedia.org/wiki/%E7%BA%A7%E8%81%94%E5%9B%9E%E6%BB%9A)ç­‰ã€‚
- Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬æœªæäº¤è¯»ï¼ˆRead uncommittedï¼‰ã€æäº¤è¯»ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚
- Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

åœ¨å•ä½“åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä¾èµ–å¤–éƒ¨æ•°æ®åº“çš„äº‹åŠ¡ç‰¹æ€§æ¥å®ç°ã€‚ä½†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œå°±æ— æ³•ä¾èµ–å¤–éƒ¨çš„äº‹åŠ¡ã€‚

> [!important]  
> ğŸ¤”æ•°æ®åº“æ˜¯å¦‚ä½•å®ç°äº‹åŠ¡çš„å‘¢ï¼Ÿ  

ä¸åŒæ•°æ®åº“å¯¹äº‹åŠ¡çš„å®ç°æ–¹å¼ä¸åŒï¼Œä½†æ˜¯å¤§å¤šä¼šä½¿ç”¨MVCCæœºåˆ¶ [[02Area/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»/äº‹åŠ¡ä¹‹ã€Œ MVCCã€\|äº‹åŠ¡ä¹‹ã€Œ MVCCã€]] ã€‚å…·ä½“å¯ä»¥çœ‹ [[02Area/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»/PostgreSQL äº‹åŠ¡åŸç†ï¼šACID å®ç° å’Œ MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶\|PostgreSQL äº‹åŠ¡åŸç†ï¼šACID å®ç° å’Œ MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶]] å’Œ [[02Area/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»/å›¾æ–‡å¹¶èŒ‚è®²è§£ Mysql äº‹åŠ¡å®ç°åŸç†\|å›¾æ–‡å¹¶èŒ‚è®²è§£ Mysql äº‹åŠ¡å®ç°åŸç†]]

# åˆ†å¸ƒå¼äº‹åŠ¡

åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼šä¸€ä¸ªä¸šåŠ¡æµç¨‹éœ€è¦ç»„åˆä¸€ç»„æœåŠ¡å®ç°ã€‚

å¸¦æ¥çš„ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜å°±æ˜¯ï¼Œéœ€è¦ä¸šåŠ¡ä¸Šä¿è¯ä¸€è‡´æ€§ã€‚å¦‚æœâ¼€ä¸ªæ­¥éª¤å¤±è´¥äº†ï¼Œé‚£ä¹ˆè¦ä¹ˆå›æ»šåˆ°ä»¥å‰çš„æœåŠ¡è°ƒâ½¤ï¼Œè¦ä¹ˆä¸æ–­é‡è¯•ä¿è¯æ‰€æœ‰çš„æ­¥éª¤éƒ½æˆåŠŸï¼Œå³ä¿è¯äº‹åŠ¡ã€‚ç”±äºä¸šåŠ¡æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥ç§°ä½œåˆ†å¸ƒå¼äº‹åŠ¡ã€‚

ä¾‹å¦‚åœ¨ä¸‹å•åœºæ™¯ä¸‹ï¼Œåº“å­˜å’Œè®¢å•å¦‚æœä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå°±æ¶‰åŠåˆ†å¸ƒå¼äº‹åŠ¡ã€‚

åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼äº‹åŠ¡åŒºåˆ«ï¼š

- é”é—®é¢˜çš„å…³é”®åœ¨äºè¿›ç¨‹æ“ä½œçš„äº’æ–¥å…³ç³»ï¼Œä¾‹å¦‚å¤šä¸ªè¿›ç¨‹åŒæ—¶ä¿®æ”¹è´¦æˆ·çš„ä½™é¢ï¼Œå¦‚æœæ²¡æœ‰äº’æ–¥å…³ç³»åˆ™ä¼šå¯¼è‡´è¯¥è´¦æˆ·çš„ä½™é¢ä¸æ­£ç¡®ã€‚
- è€Œäº‹åŠ¡é—®é¢˜çš„å…³é”®åˆ™åœ¨äºäº‹åŠ¡æ¶‰åŠçš„ä¸€ç³»åˆ—æ“ä½œéœ€è¦æ»¡è¶³ ACID ç‰¹æ€§ï¼Œä¾‹å¦‚è¦æ»¡è¶³åŸå­æ€§æ“ä½œåˆ™éœ€è¦è¿™äº›æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚

è¦è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„äº‹åŠ¡é—®é¢˜ï¼Œé¦–å…ˆè¦äº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„CAPåŸåˆ™

## CAPåŸåˆ™

> CAP åŸåˆ™åˆç§° CAP å®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚

- ä¸€è‡´æ€§
    

    ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼Œåœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åèƒ½å¤Ÿä»ä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚

    

    å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚

    
- å¯ç”¨æ€§
    

    å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚

    

    åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œè¦æ±‚ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚

    

    å¯ç”¨æ€§è®¡ç®—å…¬å¼

    

    $Availability=\frac{MTTF}{MTTF +MTTR}$

    

    MTTF æ˜¯ Mean Time To Failureï¼Œå¹³å‡æ•…éšœå‰çš„æ—¶é—´ï¼Œå³ç³»ç»Ÿå¹³å‡èƒ½å¤Ÿæ­£å¸¸è¿â¾å¤šâ»“æ—¶é—´æ‰å‘â½£â¼€æ¬¡æ•…éšœã€‚ç³»ç»Ÿçš„å¯é æ€§è¶Šâ¾¼ï¼ŒMTTFè¶Šâ»“ã€‚ï¼ˆæ³¨æ„ï¼šä»å­—â¾¯ä¸Šæ¥è¯´ï¼Œçœ‹ä¸Šå»æœ‰Failureçš„å­—æ ·ï¼Œä½†å…¶å®æ˜¯æ­£å¸¸è¿â¾çš„æ—¶é—´ã€‚ï¼‰

    

    MTTR æ˜¯ Mean Time To Recoveryï¼Œå¹³å‡ä¿®å¤æ—¶é—´ï¼Œå³ä»æ•…éšœå‡ºç°åˆ°æ•…éšœä¿®å¤çš„è¿™æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´è¶ŠçŸ­è¶Šå¥½ã€‚

    

    ![assets/Untitled 32.png|Untitled 32.png](https://s3.665210.xyz/pictures/Notion/programmer/assets/Untitled 32.png|Untitled%2032.png)

    
- åˆ†åŒºå®¹å¿æ€§
    

    ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚

    

    åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚

    

    ä¾‹å¦‚æœåŠ¡å­˜åœ¨ABCä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå­˜å‚¨ç›¸åŒçš„æ•°æ®ï¼Œåˆ†åŒºå®¹å¿æ€§è¦æ±‚åœ¨ABä¸èƒ½å’ŒCé€šä¿¡çš„æ—¶å€™ï¼Œä¹Ÿè¦æ»¡è¶³ACæ¡ä»¶ã€‚

    

![57686340-6ddd-486f-987d-5f6ffad3e9f0.jpeg](https://s3.665210.xyz/pictures/Notion/programmer/57686340-6ddd-486f-987d-5f6ffad3e9f0.jpeg)

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®é™…ä¸Šæ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚

å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ

- ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œä¸èƒ½è®¿é—®æœªåŒæ­¥å®Œæˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±å¤±å»äº†éƒ¨åˆ†å¯ç”¨æ€§ï¼›
- ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œå…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚

## BASE

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒACIDå¾ˆéš¾æ»¡è¶³é«˜æ€§èƒ½çš„è¦æ±‚ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæå‡ºçš„ä¸€ä¸ªACIDçš„å˜ç§ã€‚

> [!important]  
> ä¸ºä»€ä¹ˆä¸æ˜¯BSEï¼Œå› ä¸ºACIDåˆšå¥½æ˜¯ã€Œé…¸ã€çš„è‹±æ–‡ï¼ŒBASEæ˜¯ã€Œç¢±ã€çš„è‹±æ–‡  

- åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰
    

    æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚

    

    ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚

    
- è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰
    

    æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨æ—¶å»¶ã€‚

    
- æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰
    

    æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚

    

BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œåœ¨ä¸€ä¸ªä¸‹å•ç³»ç»Ÿä¸­ï¼ŒACIDè¦æ±‚æ¯ä¸ªç”¨æˆ·çš„è´­ä¹°è¯·æ±‚éƒ½éœ€è¦æŠŠåº“å­˜é”ä½ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªäººèƒ½è´­ä¹°ä¸‹å•ï¼›è€ŒBASEçš„åšæ³•ï¼Œå¯ä»¥å…ˆä¸‹å•ï¼Œç³»ç»Ÿå¼‚æ­¥çš„å¤„ç†è®¢å•ï¼Œåˆ¤æ–­åº“å­˜åä¼šé€šçŸ¥ä¸‹å•æ˜¯å¦æˆåŠŸï¼ˆäºšé©¬é€Šï¼Œäº¬ä¸œéƒ½æ˜¯è¿™ä¹ˆç©çš„ï¼‰

ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚

åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚

# æœ¬åœ°æ¶ˆæ¯è¡¨

æœ¬åœ°æ¶ˆæ¯è¡¨ä¸ä¸šåŠ¡æ•°æ®è¡¨å¤„äºåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚

> [!important]  
> æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œè¿˜æ˜¯å€ŸåŠ©äº†å¤–éƒ¨çš„äº‹åŠ¡ç‰¹æ€§ï¼Œå’Œåé¢çš„å…±è¯†ç®—æ³•è§£å†³é—®é¢˜çš„æ ¹æœ¬æ€è·¯ä¸ä¸€æ ·ï¼›ä½†æ˜¯å´æ˜¯è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç®€å•çš„æ–¹æ³•  

1. å½“ç³»ç»Ÿ A è¢«å…¶ä»–ç³»ç»Ÿè°ƒç”¨å‘ç”Ÿæ•°æ®åº“è¡¨æ›´æ“ä½œï¼Œé¦–å…ˆä¼šæ›´æ–°æ•°æ®åº“çš„ä¸šåŠ¡è¡¨ï¼Œå…¶æ¬¡ä¼šå¾€ç›¸åŒæ•°æ®åº“çš„æ¶ˆæ¯è¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¸¤ä¸ªæ“ä½œå‘ç”Ÿåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­
2. ç³»ç»Ÿ A çš„è„šæœ¬å®šæœŸè½®è¯¢æœ¬åœ°æ¶ˆæ¯å¾€ mq ä¸­å†™å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœè½¬å‘æˆåŠŸåˆ™å°†æ¶ˆæ¯ä»æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­åˆ é™¤ï¼Œå¦åˆ™ç»§ç»­é‡æ–°è½¬å‘ã€‚
3. ç³»ç»Ÿ B æ¶ˆè´¹ mq ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœæœ¬åœ°äº‹åŠ¡å¤„ç†å¤±è´¥ï¼Œä¼šåœ¨ç»§ç»­æ¶ˆè´¹ mq ä¸­çš„æ¶ˆæ¯è¿›è¡Œé‡è¯•ï¼Œå¦‚æœä¸šåŠ¡ä¸Šçš„å¤±è´¥ï¼Œå¯ä»¥é€šçŸ¥ç³»ç»Ÿ A è¿›è¡Œå›æ»šæ“ä½œ

![52226d00-3b24-4aa8-a78c-18b6cbf01173.png](https://s3.665210.xyz/pictures/Notion/programmer/52226d00-3b24-4aa8-a78c-18b6cbf01173.png)

æ­¤æ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯å°†éœ€è¦åˆ†å¸ƒå¼å¤„ç†çš„ä»»åŠ¡é€šè¿‡æ¶ˆæ¯æ—¥å¿—çš„æ–¹å¼æ¥å¼‚æ­¥æ‰§è¡Œã€‚æ¶ˆæ¯æ—¥å¿—å¯ä»¥å­˜å‚¨åˆ°æœ¬åœ°æ–‡æœ¬ã€æ•°æ®åº“æˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†é€šè¿‡ä¸šåŠ¡è§„åˆ™è‡ªåŠ¨æˆ–äººå·¥å‘èµ·é‡è¯•ã€‚

æœ¬åœ°æ¶ˆæ¯è¡¨å®ç°çš„æ¡ä»¶ï¼š

1. æ¶ˆè´¹è€…ä¸ç”Ÿæˆè€…çš„æ¥å£éƒ½è¦æ”¯æŒå¹‚ç­‰
2. ç”Ÿäº§è€…éœ€è¦é¢å¤–çš„åˆ›å»ºæ¶ˆæ¯è¡¨
3. éœ€è¦æä¾›è¡¥å¿é€»è¾‘ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸šåŠ¡å¤±è´¥ï¼Œéœ€è¦ç”Ÿäº§è€…æ”¯æŒå›æ»šæ“ä½œ

å®¹é”™æœºåˆ¶ï¼š

1. æ­¥éª¤ 1 å¤±è´¥æ—¶ï¼Œäº‹åŠ¡ç›´æ¥å›æ»š
2. æ­¥éª¤ 2ã€3 å†™ mq ä¸æ¶ˆè´¹ mq å¤±è´¥ä¼šè¿›è¡Œé‡è¯•
3. æ­¥éª¤ 3 ä¸šåŠ¡å¤±è´¥ç³»ç»Ÿ B å‘ç³»ç»Ÿ A å‘èµ·äº‹åŠ¡å›æ»šæ“ä½œ

# ä¸€è‡´æ€§å…±è¯†ç®—æ³•

## æ‹œå åº­å°†å†›é—®é¢˜

æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆByzantine Generals Problemï¼‰ï¼Œæ˜¯ç”±è±æ–¯åˆ©Â·å…°æ³¢ç‰¹åœ¨å…¶åŒåè®ºæ–‡[1]ä¸­æå‡ºçš„åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œé€šä¿¡å®¹é”™é—®é¢˜ã€‚

> ä¸€ç»„æ‹œå åº­å°†å†›åˆ†åˆ«å„ç‡é¢†ä¸€æ”¯å†›é˜Ÿå…±åŒå›´å›°ä¸€åº§åŸå¸‚ã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå°†å„æ”¯å†›é˜Ÿçš„è¡ŒåŠ¨ç­–ç•¥é™å®šä¸ºè¿›æ”»æˆ–æ’¤ç¦»ä¸¤ç§ã€‚å› ä¸ºéƒ¨åˆ†å†›é˜Ÿè¿›æ”»éƒ¨åˆ†å†›é˜Ÿæ’¤ç¦»å¯èƒ½ä¼šé€ æˆç¾éš¾æ€§åæœï¼Œå› æ­¤å„ä½å°†å†›å¿…é¡»é€šè¿‡æŠ•ç¥¨æ¥è¾¾æˆä¸€è‡´ç­–ç•¥ï¼Œå³æ‰€æœ‰å†›é˜Ÿä¸€èµ·è¿›æ”»æˆ–æ‰€æœ‰å†›é˜Ÿä¸€èµ·æ’¤ç¦»ã€‚å› ä¸ºå„ä½å°†å†›åˆ†å¤„åŸå¸‚ä¸åŒæ–¹å‘ï¼Œä»–ä»¬åªèƒ½é€šè¿‡ä¿¡ä½¿äº’ç›¸è”ç³»ã€‚åœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­æ¯ä½å°†å†›éƒ½å°†è‡ªå·±æŠ•ç¥¨ç»™è¿›æ”»è¿˜æ˜¯æ’¤é€€çš„ä¿¡æ¯é€šè¿‡ä¿¡ä½¿åˆ†åˆ«é€šçŸ¥å…¶ä»–æ‰€æœ‰å°†å†›ï¼Œè¿™æ ·ä¸€æ¥æ¯ä½å°†å†›æ ¹æ®è‡ªå·±çš„æŠ•ç¥¨å’Œå…¶ä»–æ‰€æœ‰å°†å†›é€æ¥çš„ä¿¡æ¯å°±å¯ä»¥çŸ¥é“å…±åŒçš„æŠ•ç¥¨ç»“æœè€Œå†³å®šè¡ŒåŠ¨ç­–ç•¥ã€‚

ç³»ç»Ÿä¸­å­˜åœ¨çš„é—®é¢˜ï¼š

1. å°†å†›ä¸­å­˜åœ¨å›å¾’ï¼Œä¼šå‘èµ·æ¶æ„æŠ•ç¥¨
2. ä¼ é€’çš„ä¿¡ä½¿ä¸­å­˜åœ¨å›å¾’

å¯¹åº”åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå³å­˜åœ¨ä¿¡æ¯æºä¸å¯é ï¼Œä¿¡æ¯çš„ä¼ é€’è¿‡ç¨‹ä¸å¯é ã€‚

å‡ä½¿é‚£äº›å¿ è¯šï¼ˆæˆ–æ˜¯æ²¡æœ‰å‡ºé”™ï¼‰çš„å°†å†›ä»ç„¶èƒ½é€šè¿‡å¤šæ•°å†³å®šæ¥å†³å®šä»–ä»¬çš„æˆ˜ç•¥ï¼Œä¾¿ç§°è¾¾åˆ°äº†æ‹œå åº­å®¹é”™ã€‚

æ‹œå åº­å°†å†›é—®é¢˜æ¯”è¾ƒéš¾è§£ï¼Œè±æ–¯åˆ©Â·å…°ä¼¯ç‰¹è¯æ˜ï¼Œå½“å›å˜è€…ä¸è¶…è¿‡ 1/3æ—¶ï¼Œå­˜åœ¨æœ‰æ•ˆçš„ç®—æ³•ã€‚ä¸è®ºå›å˜è€…å¦‚ä½•æŠ˜è…¾ï¼Œå¿ è¯šçš„å°†å†›ä»¬æ€»èƒ½è¾¾æˆâ¼€è‡´çš„ç»“æœã€‚å¦‚æœå›å˜è€…è¿‡å¤šï¼Œåˆ™â½†æ³•ä¿è¯â¼€å®šèƒ½è¾¾åˆ°â¼€è‡´æ€§

å³åœ¨å°†å†›çš„æ€»æ•°ä¸ºnï¼Œné‡Œé¢èƒŒå›è€…çš„æ•°é‡ä¸ºtï¼Œåˆ™åªè¦n > 3tå°±å¯ä»¥å®ç°å®¹é”™ã€‚ç›®å‰ä¹Ÿæœ‰ä¸€äº›è§£å†³çš„ç®—æ³•ï¼Œä¾‹å¦‚PBFTç®—æ³•ã€‚

ä½†æ˜¯è¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼Œå¼•å…¥æ‹œå åº­é—®é¢˜ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„æŒ‘æˆ˜ï¼Œåœ¨æˆ‘ä»¬å®é™…ç§æœ‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯ä»¥è®¤ä¸ºèŠ‚ç‚¹ä¸ä¼šå‡ºç°æ¶æ„ï¼Œé€šä¿¡è¿‡ç¨‹é™¤äº†ç½‘ç»œæ•…éšœå¤–éƒ½æ˜¯å¯é çš„ã€‚è¿™æ ·é—®é¢˜å˜å¾—ç®€åŒ–äº†ï¼Œæˆä¸ºåœ¨ç³»ç»Ÿå¤šä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸åŒæ„è§çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è®©æ‰€æœ‰èŠ‚ç‚¹è¾¾æˆå…±è¯†ï¼Œ

## ä¸¤é˜¶æ®µæäº¤2PC

ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼Œ2PCï¼‰ï¼Œé€šè¿‡å¼•å…¥åè°ƒè€…ï¼ˆCoordinatorï¼‰æ¥åè°ƒå‚ä¸è€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸è€…æ˜¯å¦è¦çœŸæ­£æ‰§è¡Œäº‹åŠ¡ã€‚

### è¿è¡Œè¿‡ç¨‹

1. å‡†å¤‡é˜¶æ®µ
    

    åè°ƒè€…è¯¢é—®å‚ä¸è€…äº‹åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå‚ä¸è€…å‘å›äº‹åŠ¡æ‰§è¡Œç»“æœã€‚è¯¢é—®å¯ä»¥çœ‹æˆä¸€ç§æŠ•ç¥¨ï¼Œéœ€è¦å‚ä¸è€…éƒ½åŒæ„æ‰èƒ½æ‰§è¡Œã€‚

    

    ![befbb1b4-3bd1-40cf-8105-48a412ce1178.png](https://s3.665210.xyz/pictures/Notion/programmer/befbb1b4-3bd1-40cf-8105-48a412ce1178.png)

    
2. æäº¤é˜¶æ®µ
    

    å¦‚æœäº‹åŠ¡åœ¨æ¯ä¸ªå‚ä¸è€…ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…æäº¤äº‹åŠ¡ï¼›å¦åˆ™ï¼Œåè°ƒè€…å‘é€é€šçŸ¥è®©å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚

    

    éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‡†å¤‡é˜¶æ®µï¼Œå‚ä¸è€…æ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æœªæäº¤ã€‚åªæœ‰åœ¨æäº¤é˜¶æ®µæ¥æ”¶åˆ°åè°ƒè€…å‘æ¥çš„é€šçŸ¥åï¼Œæ‰è¿›è¡Œæäº¤æˆ–è€…å›æ»šã€‚

    

    ![66f71295-e44b-42a3-8c23-ebbafcdae6a7.png](https://s3.665210.xyz/pictures/Notion/programmer/66f71295-e44b-42a3-8c23-ebbafcdae6a7.png)

    

### å­˜åœ¨çš„é—®é¢˜

- åŒæ­¥é˜»å¡
    

    æ‰€æœ‰äº‹åŠ¡å‚ä¸è€…åœ¨ç­‰å¾…å…¶å®ƒå‚ä¸è€…å“åº”çš„æ—¶å€™éƒ½å¤„äºåŒæ­¥é˜»å¡ç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œå…¶å®ƒæ“ä½œã€‚

    
- å•ç‚¹é—®é¢˜
    

    åè°ƒè€…åœ¨ 2PC ä¸­èµ·åˆ°éå¸¸å¤§çš„ä½œç”¨ï¼Œå‘ç”Ÿæ•…éšœå°†ä¼šé€ æˆå¾ˆå¤§å½±å“ã€‚ç‰¹åˆ«æ˜¯åœ¨æäº¤é˜¶æ®µå‘ç”Ÿæ•…éšœï¼Œæ‰€æœ‰å‚ä¸è€…ä¼šä¸€ç›´åŒæ­¥é˜»å¡ç­‰å¾…ï¼Œæ— æ³•å®Œæˆå…¶å®ƒæ“ä½œã€‚

    
- æ•°æ®ä¸ä¸€è‡´
    

    åœ¨æäº¤é˜¶æ®µï¼Œå¦‚æœåè°ƒè€…åªå‘é€äº†éƒ¨åˆ† Commit æ¶ˆæ¯ï¼Œæ­¤æ—¶ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆåªæœ‰éƒ¨åˆ†å‚ä¸è€…æ¥æ”¶åˆ° Commit æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰éƒ¨åˆ†å‚ä¸è€…æäº¤äº†äº‹åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ã€‚

    
- å¤ªè¿‡ä¿å®ˆ
    

    ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥å°±ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œæ²¡æœ‰å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚

    

ç°åœ¨ï¼Œå¾ˆå¤šå…¬å¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸¤é˜¶æ®µæäº¤çš„å˜ç§ã€‚â½å¦‚ï¼šé˜¿â¾¥æ¨å‡ºçš„TCC(Tryâ€“Confirmâ€“Cancel)ï¼Œæˆ–æ˜¯äºšâ»¢é€Šçš„Planâ€“Reserveâ€“Confirmçš„â½…å¼ï¼Œç­‰ç­‰ã€‚==**å‡¡æ˜¯é€šè¿‡ä¸šåŠ¡è¡¥å¿ï¼Œæˆ–æ˜¯åœ¨ä¸šåŠ¡åº”â½¤å±‚ä¸Šåšçš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ç©æ³•ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸¤é˜¶æ®µæäº¤ï¼Œæˆ–æ˜¯ä¸¤é˜¶æ®µæäº¤çš„å˜ç§ã€‚**==

### ä¸‰é˜¶æ®µæäº¤3PC

ä¸‰æ®µæäº¤ï¼ˆ3PCï¼‰æ˜¯å¯¹ä¸¤æ®µæäº¤ï¼ˆ2PCï¼‰çš„ä¸€ç§å‡çº§ä¼˜åŒ–ï¼Œ3PCåœ¨2PCçš„ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µã€‚ä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰ï¼Œå„å‚ä¸è€…èŠ‚ç‚¹çš„çŠ¶æ€éƒ½ä¸€è‡´ã€‚

![assets/Untitled 1 15.png|Untitled 1 15.png](https://s3.665210.xyz/pictures/Notion/programmer/assets/Untitled 1 15.png|Untitled 1%2015.png)

3PC çš„ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«æ˜¯`CanCommit`ã€`PreCommit`ã€`DoCommit`

**CanCommit**ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€CanCommitå‘½ä»¤ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œã€‚å¦‚æœå…¨éƒ¨å“åº”YESåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚

**PreCommit**ï¼š`åè°ƒè€…`å‘æ‰€æœ‰`å‚ä¸è€…`å‘é€`PreCommit`å‘½ä»¤ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥è¿›è¡Œäº‹åŠ¡çš„é¢„æäº¤æ“ä½œï¼Œå‚ä¸è€…æ¥æ”¶åˆ°PreCommitè¯·æ±‚åï¼Œå¦‚å‚ä¸è€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›`Yes`å“åº”ï¼Œè¿›å…¥æœ€ç»ˆcommité˜¶æ®µã€‚ä¸€æ—¦å‚ä¸è€…ä¸­æœ‰å‘åè°ƒè€…å‘é€äº†`No`å“åº”ï¼Œæˆ–å› ç½‘ç»œé€ æˆè¶…æ—¶ï¼Œåè°ƒè€…æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€`abort`è¯·æ±‚ï¼Œå‚ä¸è€…æ¥å—abortå‘½ä»¤æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚

**DoCommit**ï¼š åœ¨å‰ä¸¤ä¸ªé˜¶æ®µä¸­æ‰€æœ‰å‚ä¸è€…çš„å“åº”åé¦ˆå‡æ˜¯`YES`åï¼Œåè°ƒè€…å‘å‚ä¸è€…å‘é€`DoCommit`å‘½ä»¤æ­£å¼æäº¤äº‹åŠ¡ï¼Œå¦‚åè°ƒè€…æ²¡æœ‰æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼Œä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€`abort`è¯·æ±‚å‘½ä»¤ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚

å¯¹æ¯”2é˜¶æ®µæäº¤ï¼š

1. å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œè§£å†³äº†åŒæ­¥é˜»å¡çš„é—®é¢˜ã€‚
    

    åœ¨2PCä¸­ï¼Œå‡†å¤‡é˜¶æ®µæ‰§è¡Œäº†äº‹åŠ¡ï¼Œä½†æ˜¯åè°ƒè€…éœ€è¦ç­‰å¾…æ‰€æœ‰å‚ä¸è€…è¿”å›yesåï¼Œæ‰ä¼šè¿›å…¥æäº¤é˜¶æ®µï¼Œå¦‚æœå› ä¸ºç½‘ç»œåŸå› å‡†å¤‡é˜¶æ®µåè°ƒè€…æ²¡æœ‰æ”¶åˆ°æŸä¸ªå“åº”ï¼Œå‰©ä¸‹çš„å‚ä¸è€…ä¼šä¸€ç›´ç­‰å¾…

    
2. åœ¨æäº¤é˜¶æ®µå‘ç”Ÿå¤±è´¥ï¼Œä¾æ—§å¯ä»¥å›æ»š

å½“ç„¶ï¼Œç¼ºç‚¹æ˜¯æœ€ç»ˆä¹Ÿä¼šåœ¨å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚

### TCCçš„å®ç°

å…³äº TCCï¼ˆTry-Confirm-Cancelï¼‰çš„æ¦‚å¿µï¼Œæœ€æ—©æ˜¯ç”± Pat Helland äº 2007 å¹´å‘è¡¨çš„ä¸€ç¯‡åä¸ºã€ŠLife beyond Distributed Transactions:an Apostateâ€™s Opinionã€‹çš„è®ºæ–‡æå‡ºï¼Œåˆè¢«ç§°è¡¥å¿äº‹åŠ¡ã€‚ TCC äº‹åŠ¡æœºåˆ¶ç›¸æ¯”äºä¸Šé¢ä»‹ç»çš„ 2PCï¼Œè§£å†³äº†å…¶å‡ ä¸ªç¼ºç‚¹ï¼š

1. è§£å†³äº†åè°ƒè€…å•ç‚¹ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶å®Œæˆè¿™ä¸ªä¸šåŠ¡æ´»åŠ¨ã€‚ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ä¹Ÿå˜æˆå¤šç‚¹ï¼Œå¼•å…¥é›†ç¾¤ã€‚
2. åŒæ­¥é˜»å¡ï¼šå¼•å…¥è¶…æ—¶ï¼Œè¶…æ—¶åè¿›è¡Œè¡¥å¿ï¼Œå¹¶ä¸”ä¸ä¼šé”å®šæ•´ä¸ªèµ„æºï¼Œå°†èµ„æºè½¬æ¢ä¸ºä¸šåŠ¡é€»è¾‘å½¢å¼ï¼Œç²’åº¦å˜å°ã€‚
3. æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰äº†è¡¥å¿æœºåˆ¶ä¹‹åï¼Œç”±ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨æ§åˆ¶ä¸€è‡´æ€§

æ‰§è¡Œè¿‡ç¨‹

1. Try é˜¶æ®µï¼šå°è¯•æ‰§è¡Œï¼Œå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰, é¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰
2. Confirm é˜¶æ®µï¼šç¡®è®¤æ‰§è¡ŒçœŸæ­£æ‰§è¡Œä¸šåŠ¡ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼ŒConfirm æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚è¦æ±‚å…·å¤‡å¹‚ç­‰è®¾è®¡ï¼ŒConfirm å¤±è´¥åéœ€è¦è¿›è¡Œé‡è¯•ã€‚
3. Cancel é˜¶æ®µï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æº Cancel æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ Cancel é˜¶æ®µçš„å¼‚å¸¸å’Œ Confirm é˜¶æ®µå¼‚å¸¸å¤„ç†æ–¹æ¡ˆåŸºæœ¬ä¸Šä¸€è‡´ã€‚

åœ¨ Try é˜¶æ®µï¼Œæ˜¯å¯¹ä¸šåŠ¡ç³»ç»Ÿè¿›è¡Œæ£€æŸ¥åŠèµ„æºé¢„è§ˆï¼Œæ¯”å¦‚è®¢å•å’Œå­˜å‚¨æ“ä½œï¼Œéœ€è¦æ£€æŸ¥åº“å­˜å‰©ä½™æ•°é‡æ˜¯å¦å¤Ÿç”¨ï¼Œå¹¶è¿›è¡Œé¢„ç•™ï¼Œé¢„ç•™æ“ä½œçš„è¯å°±æ˜¯æ–°å»ºä¸€ä¸ªå¯ç”¨åº“å­˜æ•°é‡å­—æ®µï¼ŒTry é˜¶æ®µæ“ä½œæ˜¯å¯¹è¿™ä¸ªå¯ç”¨åº“å­˜æ•°é‡è¿›è¡Œæ“ä½œã€‚

åŸºäº TCC å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¼šå°†åŸæ¥åªéœ€è¦ä¸€ä¸ªæ¥å£å°±å¯ä»¥å®ç°çš„é€»è¾‘æ‹†åˆ†ä¸º Tryã€Confirmã€Cancel ä¸‰ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä»£ç å®ç°å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ã€‚

ä»¥Aè´¦æˆ·å‘Bè´¦æˆ·æ±‡æ¬¾100å…ƒä¸ºä¾‹ï¼Œå›¾9-11å±•ç¤ºäº†TCCçš„æµç¨‹ã€‚æ±‡æ¬¾æœåŠ¡å’Œæ”¶æ¬¾æœåŠ¡éœ€è¦åˆ†åˆ«å®ç°Tryã€Confirmã€Cancelè¿™ä¸‰ä¸ªæ¥å£ï¼Œå¹¶åœ¨ä¸šåŠ¡åˆå§‹åŒ–é˜¶æ®µå°†è¿™ä¸‰ä¸ªæ¥å£çš„å®ç°æ³¨å…¥TCCäº‹åŠ¡ç®¡ç†å™¨ã€‚

![assets/Untitled 2 14.png|Untitled 2 14.png](https://s3.665210.xyz/pictures/Notion/programmer/assets/Untitled 2 14.png|Untitled 2%2014.png)

## Paxos

Paxos ç®—æ³•æ˜¯åˆ†å¸ƒå¼æŠ€æœ¯å¤§å¸ˆ Lamport æå‡ºçš„ï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡è¿™ä¸ªç®—æ³•ï¼Œè®©å‚ä¸åˆ†å¸ƒå¼å¤„ç†çš„æ¯ä¸ªå‚ä¸è€…é€æ­¥è¾¾æˆä¸€è‡´æ„è§ã€‚ç”¨å¥½ç†è§£çš„æ–¹å¼æ¥è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œè®©ä¸åŒçš„é€‰æ°‘æœ€ç»ˆåšå‡ºä¸€è‡´çš„å†³å®šã€‚

Lamport ä¸ºäº†è®²è¿°è¿™ä¸ªç®—æ³•ï¼Œå‡æƒ³äº†ä¸€ä¸ªå«åš Paxos çš„å¸Œè…ŠåŸé‚¦è¿›è¡Œé€‰ä¸¾çš„æƒ…æ™¯ï¼Œè¿™ä¸ªç®—æ³•ä¹Ÿæ˜¯å› æ­¤è€Œå¾—åã€‚åœ¨ä»–çš„å‡æƒ³ä¸­ï¼Œè¿™ä¸ªåŸé‚¦è¦é‡‡ç”¨æ°‘ä¸»æè®®å’ŒæŠ•ç¥¨çš„æ–¹å¼é€‰å‡ºä¸€ä¸ªæœ€ç»ˆçš„å†³è®®ï¼Œä½†ç”±äºåŸé‚¦çš„å±…æ°‘æ²¡æœ‰äººæ„¿æ„æŠŠå…¨éƒ¨æ—¶é—´å’Œç²¾åŠ›æ”¾åœ¨è¿™ç§äº‹æƒ…ä¸Šï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½ä¸å®šæ—¶çš„æ¥å‚åŠ æè®®ï¼Œä¸å®šæ—¶æ¥äº†è§£æè®®ã€æŠ•ç¥¨è¿›å±•ï¼Œä¸å®šæ—¶çš„è¡¨è¾¾è‡ªå·±çš„æŠ•ç¥¨æ„è§ã€‚Paxos ç®—æ³•çš„ç›®æ ‡å°±æ˜¯è®©ä»–ä»¬æŒ‰ç…§å°‘æ•°æœä»å¤šæ•°çš„æ–¹å¼ï¼Œæœ€ç»ˆè¾¾æˆä¸€è‡´æ„è§ã€‚

ç”¨äºè¾¾æˆå…±è¯†æ€§é—®é¢˜ï¼Œå³å¯¹å¤šä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„å€¼ï¼Œè¯¥ç®—æ³•èƒ½ä¿è¯åªé€‰å‡ºå”¯ä¸€ä¸€ä¸ªå€¼ã€‚

ä¸»è¦æœ‰ä¸‰ç±»èŠ‚ç‚¹ï¼š

- æè®®è€…ï¼ˆProposerï¼‰ï¼šæè®®ä¸€ä¸ªå€¼ï¼›
- æ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šå¯¹æ¯ä¸ªæè®®è¿›è¡ŒæŠ•ç¥¨ï¼›
- å‘ŠçŸ¥è€…ï¼ˆLearnerï¼‰ï¼šè¢«å‘ŠçŸ¥æŠ•ç¥¨çš„ç»“æœï¼Œä¸å‚ä¸æŠ•ç¥¨è¿‡ç¨‹ã€‚

![5966d159-3f60-4646-8aa8-786b5933cc41.jpeg](https://s3.665210.xyz/pictures/Notion/programmer/5966d159-3f60-4646-8aa8-786b5933cc41.jpeg)

### æ‰§è¡Œè¿‡ç¨‹

è§„å®šä¸€ä¸ªæè®®åŒ…å«ä¸¤ä¸ªå­—æ®µï¼š[n, v]ï¼Œå…¶ä¸­ n ä¸ºåºå·ï¼ˆå…·æœ‰å”¯ä¸€æ€§ï¼‰ï¼Œv ä¸ºæè®®å€¼ã€‚

1. Prepare é˜¶æ®µ
    

    ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ª Proposer å’Œä¸‰ä¸ª Acceptor çš„ç³»ç»Ÿä¸­è¿è¡Œè¯¥ç®—æ³•çš„åˆå§‹è¿‡ç¨‹ï¼Œæ¯ä¸ª Proposer éƒ½ä¼šå‘æ‰€æœ‰ Acceptor å‘é€ Prepare è¯·æ±‚ã€‚

    

    ![a41bc429-6bd8-47ee-bda6-b90eb9b2da46.png](https://s3.665210.xyz/pictures/Notion/programmer/a41bc429-6bd8-47ee-bda6-b90eb9b2da46.png)

    

    å½“ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ª Prepare è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¹‹å‰è¿˜æœªæ¥æ”¶è¿‡ Prepare è¯·æ±‚ï¼Œé‚£ä¹ˆå‘é€ä¸€ä¸ª Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n1, v1]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n1 çš„æè®®ã€‚

    

    ä¸Šå›¾ä¸­ï¼ŒAcceptor Xå’ŒYå…ˆæ”¶åˆ°äº†Açš„è¯·æ±‚ï¼ŒAcceptor Zæ”¶åˆ°äº†Bçš„è¯·æ±‚

    

    å¦‚ä¸‹å›¾ï¼ŒAcceptor X åœ¨æ”¶åˆ° [n=2, v=8] çš„ Prepare è¯·æ±‚æ—¶ï¼Œç”±äºä¹‹å‰æ²¡æœ‰æ¥æ”¶è¿‡æè®®ï¼Œå› æ­¤å°±å‘é€ä¸€ä¸ª [no previous] çš„ Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 2 çš„æè®®ã€‚å…¶å®ƒçš„ Acceptor ç±»ä¼¼ã€‚

    
      
    

    ![assets/Untitled 3 10.png|Untitled 3 10.png](https://s3.665210.xyz/pictures/Notion/programmer/assets/Untitled 3 10.png|Untitled 3%2010.png)

    

    å¦‚æœ Acceptor æ¥æ”¶åˆ°ä¸€ä¸ª Prepare è¯·æ±‚ï¼ŒåŒ…å«çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¹‹å‰å·²ç»æ¥æ”¶è¿‡æè®® [n1, v1]ã€‚å¦‚æœ n1 > n2ï¼Œé‚£ä¹ˆå°±ä¸¢å¼ƒè¯¥æè®®è¯·æ±‚ï¼›å¦åˆ™ï¼Œå‘é€ Prepare å“åº”ï¼Œè¯¥ Prepare å“åº”åŒ…å«ä¹‹å‰å·²ç»æ¥æ”¶è¿‡çš„æè®® [n1, v1]ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n2, v2]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº n2 çš„æè®®ã€‚

    

    å¦‚ä¸‹å›¾ï¼ŒAcceptor Z åç»­æ”¶åˆ°äº† Proposer A å‘æ¥çš„ [n=2, v=8] çš„ Prepare è¯·æ±‚ï¼Œç”±äºä¹‹å‰å·²ç»æ¥æ”¶è¿‡ [n=4, v=5] çš„æè®®ï¼Œå¹¶ä¸” n > 2ï¼Œå› æ­¤å°±æŠ›å¼ƒè¯¥æè®®è¯·æ±‚ï¼›Acceptor X æ”¶åˆ° Proposer B å‘æ¥çš„ [n=4, v=5] çš„ Prepare è¯·æ±‚ï¼Œå› ä¸ºä¹‹å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=2, v=8]ï¼Œå¹¶ä¸” 2 <= 4ï¼Œå› æ­¤å°±å‘é€ [n=2, v=8] çš„ Prepare å“åº”ï¼Œè®¾ç½®å½“å‰æ¥æ”¶åˆ°çš„æè®®ä¸º [n=4, v=5]ï¼Œå¹¶ä¸”ä¿è¯ä»¥åä¸ä¼šå†æ¥å—åºå·å°äº 4 çš„æè®®ã€‚Acceptor Y ç±»ä¼¼ã€‚

    

    ![98969449-75fc-4430-839b-ba76ee7a94a2.jpeg](https://s3.665210.xyz/pictures/Notion/programmer/98969449-75fc-4430-839b-ba76ee7a94a2.jpeg)

    
2. Accept é˜¶æ®µ
    

    å½“ä¸€ä¸ª Proposer æ¥æ”¶åˆ°è¶…è¿‡ä¸€åŠ Acceptor çš„ Prepare å“åº”æ—¶ï¼Œå°±å¯ä»¥å‘é€ Accept è¯·æ±‚ã€‚

    

    Proposer A æ¥æ”¶åˆ°ä¸¤ä¸ª Prepare å“åº”ä¹‹åï¼Œå°±å‘é€ [n=2, v=8] Accept è¯·æ±‚ã€‚è¯¥ Accept è¯·æ±‚ä¼šè¢«æ‰€æœ‰ Acceptor ä¸¢å¼ƒï¼Œå› ä¸ºæ­¤æ—¶æ‰€æœ‰ Acceptor éƒ½ä¿è¯ä¸æ¥å—åºå·å°äº 4 çš„æè®®ã€‚

    

    Proposer B è¿‡åä¹Ÿæ”¶åˆ°äº†ä¸¤ä¸ª Prepare å“åº”ï¼Œå› æ­¤ä¹Ÿå¼€å§‹å‘é€ Accept è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒAccept è¯·æ±‚çš„ v éœ€è¦å–å®ƒæ”¶åˆ°çš„æœ€å¤§æè®®ç¼–å·å¯¹åº”çš„ v å€¼ï¼Œä¹Ÿå°±æ˜¯ 8ã€‚å› æ­¤å®ƒå‘é€ [n=4, v=8] çš„ Accept è¯·æ±‚ã€‚

    

    ![8c2973cc-5ff2-443d-a0ab-88fb30fdc6f0.png](https://s3.665210.xyz/pictures/Notion/programmer/8c2973cc-5ff2-443d-a0ab-88fb30fdc6f0.png)

    
3. Learn é˜¶æ®µ
    

    Acceptor æ¥æ”¶åˆ° Accept è¯·æ±‚æ—¶ï¼Œå¦‚æœåºå·å¤§äºç­‰äºè¯¥ Acceptor æ‰¿è¯ºçš„æœ€å°åºå·ï¼Œé‚£ä¹ˆå°±å‘é€ Learn æè®®ç»™æ‰€æœ‰çš„ Learnerã€‚å½“ Learner å‘ç°æœ‰å¤§å¤šæ•°çš„ Acceptor æ¥æ”¶äº†æŸä¸ªæè®®ï¼Œé‚£ä¹ˆè¯¥æè®®çš„æè®®å€¼å°±è¢« Paxos é€‰æ‹©å‡ºæ¥ã€‚

    

    ![7ee34e64-9cdf-45ca-88e4-bab0b6ab2fe3.jpeg](https://s3.665210.xyz/pictures/Notion/programmer/7ee34e64-9cdf-45ca-88e4-bab0b6ab2fe3.jpeg)

    

Paxos ç®—æ³•çš„é€šä¿—ç†è§£ï¼š

åœ¨æ•´ä¸ªæè®®å’ŒæŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä¸»è¦çš„è§’è‰²å°±æ˜¯ â€œæè®®è€…â€ï¼ˆå‘â€œæ¥å—è€…â€ æå‡ºæè®®ï¼‰å’Œ â€œæ¥å—è€…â€ï¼ˆæ”¶åˆ°â€œæè®®è€…â€ çš„æè®®åï¼Œå‘ â€œæè®®è€…â€ è¡¨è¾¾è‡ªå·±çš„æ„è§ï¼‰ã€‚

æ•´ä¸ªç®—æ³•çš„å¤§è‡´è¿‡ç¨‹ä¸ºï¼š

1. ç¬¬ä¸€é˜¶æ®µï¼šå› ä¸ºå­˜åœ¨å¤šä¸ª â€œæè®®è€…â€ï¼Œå¦‚æœéƒ½ææ„è§ï¼Œé‚£ä¹ˆâ€œæ¥å—è€…â€ æ¥å—è°çš„ä¸æ¥å—è°çš„ï¼Ÿå¤ªæ··ä¹±äº†ã€‚æ‰€ä»¥ï¼Œè¦å…ˆæ˜ç¡®å“ªä¸ª â€œæè®®è€…â€ æ˜¯æ„è§é¢†è¢–æœ‰æƒæå‡ºæè®®ï¼Œæœªæ¥ï¼Œâ€œæ¥å—è€…â€ä»¬å°±ä¸»è¦å¤„ç†è¿™ä¸ª â€œæè®®è€…â€ çš„æè®®äº†**ï¼ˆè¿™æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨æå‡ºæè®®æ—¶å°±å°½é‡è®©æ„è§ç»Ÿä¸€ï¼Œè°‹æ±‚å°½æ—©å½¢æˆå¤šæ•°æ´¾ï¼‰ã€‚**
    

    æ‰€æœ‰çš„æè®®è€…å‘æ‰€æœ‰çš„æ¥å—è€…å‘é€å»ºè®®ï¼ˆprepareè¯·æ±‚ï¼‰ï¼Œä¸€ä¸ªæ¥å—è€…ä¼šæ”¶åˆ°å¤šä¸ªæ„è§ï¼Œæ ¹æ®æ„è§çš„åºå·ï¼Œç¡®å®šä¼šæ¥å—è°çš„æ„è§ã€‚

    

    æ¥å—è€…å¯¹æ”¶åˆ°çš„prepareè¯·æ±‚ï¼Œå¦‚æœåºå·ä½äºå½“å‰å·²ç»æ”¶åˆ°çš„ï¼Œå¿½è§†ï¼›å¤§äºç­‰äºå½“å‰åºå·ï¼Œè¿”å›ä¹‹å‰ä¿å­˜çš„å»ºè®®ï¼ˆå¯èƒ½æ˜¯ç©ºï¼Œä¹Ÿå¯èƒ½æ˜¯åºå·æ¯”è¾ƒä½çš„å»ºè®®ï¼‰

    
2. ç¬¬äºŒé˜¶æ®µï¼šç”±ä¸Šé˜¶æ®µé€‰å‡ºçš„æ„è§é¢†è¢–æå‡ºæè®®ï¼Œâ€œæ¥å—è€…â€åé¦ˆæ„è§ã€‚å¦‚æœå¤šæ•° â€œæ¥å—è€…â€ æ¥å—äº†ä¸€ä¸ªæè®®ï¼Œé‚£ä¹ˆæè®®å°±é€šè¿‡äº†ã€‚
    

    å½“æ¯ä¸ªæè®®è€…è·å¾—è¶…è¿‡ä¸€åŠçš„æ¥å—è€…çš„å›å¤åï¼Œå¼€å§‹å‘èµ·acceptè¯·æ±‚ï¼Œè¯·æ±‚çš„åºå·è¿˜æ˜¯ä¹‹å‰è‡ªå·±æè®®çš„åºå·ï¼Œä½†æ˜¯è¯·æ±‚çš„væ˜¯ä¸Šä¸€é˜¶æ®µæ”¶åˆ°çš„æ¥å—è€…çš„åé¦ˆæœ€å¤§åºå·çš„vï¼Œå¦‚æœä¸Šä¸€é˜¶æ®µåé¦ˆæ˜¯no previousåˆ™vè¿˜æ˜¯è‡ªå·±æè®®çš„vï¼Œå¦‚æœä¸Šä¸€é˜¶æ®µæœ‰å¤šä¸ªäººåé¦ˆï¼Œåˆ™å–å…¶ä¸­åºå·æœ€å¤§çš„å¯¹åº”çš„v(è¿™ä¸ªåºå·æœ€å¤§ä¸åŒ…å«è‡ªå·±çš„åºå·ï¼ï¼ï¼‰

    

    æ¥å—è€…è¿˜æ˜¯ä¼šä¸¢å¼ƒåºå·å°äºå½“å‰å·²ç»ä¿å­˜çš„æè®®ï¼Œå¤§äºç­‰äºæ—¶åˆ™æ›´æ–°ã€‚

    
3. ç¬¬ä¸‰é˜¶æ®µï¼šå¦‚æœä¸€ä¸ªæ¥å—è€…æ¥æ”¶åˆ°äº†å¤§äºç­‰äºå½“å‰åºå·çš„acceptè¯·æ±‚ï¼Œåˆ™å‘learnå‘å‡ºä¸€ä¸ªæè®®ï¼Œå¦‚æœlearnå‘ç°å¤§éƒ¨åˆ†æ¥å—è€…éƒ½æ¥å—äº†æŸä¸ªæè®®ï¼Œè¿™ä¸ªæè®®å°±è¢«æ¥å—äº†ã€‚

å¿…é¡»è¦äº†è§£çš„å…¶ä»–ç›¸å…³èƒŒæ™¯ï¼š

1. æ€ä¹ˆæ˜ç¡®æ„è§é¢†è¢–å‘¢ï¼Ÿé€šè¿‡ç¼–å·ã€‚æ¯ä¸ª â€œæè®®è€…â€ åœ¨ç¬¬ä¸€é˜¶æ®µå…ˆæŠ¥ä¸ªå·ï¼Œè°çš„å·å¤§ï¼Œè°å°±æ˜¯æ„è§é¢†è¢–ã€‚å¦‚æœä¸å¥½ç†è§£ï¼Œå¯ä»¥æƒ³è±¡ä¸ºè´¿é€‰ã€‚æ¯ä¸ªæè®®è€…å…ˆæ‹¿ç€é’ç¥¨è´¿èµ‚ä¸€åœˆ â€œæ¥å—è€…â€ï¼Œè°ç»™çš„é’±å¤šï¼Œç¬¬äºŒé˜¶æ®µâ€œæ¥å—è€…â€ å°±å¬è°çš„ã€‚ï¼ˆæ³¨ï¼šè¿™é‡Œå’Œä¸‹æ–‡æåˆ°çš„ â€œæ„è§é¢†è¢–â€ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„è§’è‰²ï¼Œè€Œæ˜¯ä»£è¡¨åœ¨é‚£ä¸€è½®è´¿èµ‚æˆåŠŸçš„â€œæè®®è€…â€ã€‚æ‰€ä»¥ï¼Œè¯·æŠŠæ„è§é¢†è¢–ç†è§£ä¸ºè´¿èµ‚ä¸­èƒœå‡ºçš„â€œæè®®è€…â€ å³å¯ï¼‰
2. æœ‰ä¸ªè·Ÿé€‰ä¸¾å¸¸è¯†ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå°±æ˜¯æ¯ä¸ª â€œæè®®è€…â€ ä¸ä¼šæ‰§ç€äºè®©è‡ªå·±çš„æè®®é€šè¿‡ï¼Œè€Œæ˜¯æ¯ä¸ª â€œæè®®è€…â€ ä¼šæ‰§ç€äºè®©æè®®å°½å¿«è¾¾æˆä¸€è‡´æ„è§ã€‚æ‰€ä»¥ï¼Œä¸ºäº†è¿™ä¸ªç›®æ ‡ï¼Œå¦‚æœ â€œæè®®è€…â€ åœ¨è´¿é€‰çš„æ—¶å€™ï¼Œå‘ç° â€œæ¥å—è€…â€ å·²ç»æ¥å—è¿‡å‰é¢æ„è§é¢†è¢–çš„æè®®äº†ï¼Œå³ä¾¿ â€œæè®®è€…â€ è´¿é€‰æˆåŠŸï¼Œä¹Ÿä¼šé»˜é»˜çš„æŠŠè‡ªå·±çš„æè®®æ”¹ä¸ºå‰é¢æ„è§é¢†è¢–çš„æè®®ã€‚æ‰€ä»¥ä¸€æ—¦è´¿èµ‚æˆåŠŸï¼Œèƒœå‡ºçš„ â€œæè®®è€…â€ å†æå‡ºæè®®ï¼Œæè®®å†…å®¹ä¹Ÿæ˜¯å‰é¢æ„è§é¢†è¢–çš„æè®®**ï¼ˆè¿™æ ·ï¼Œåœ¨è°‹æ±‚å°½æ—©å½¢æˆå¤šæ•°æ´¾çš„è·¯ä¸Šï¼Œåˆå‰è¿›äº†ä¸€æ­¥ï¼‰**ã€‚
3. é’±çš„å¤šå°‘å¾ˆé‡è¦ï¼Œå¦‚æœé’±å°‘äº†ï¼Œæ— è®ºåœ¨ç¬¬ä¸€è¿˜æ˜¯ç¬¬äºŒé˜¶æ®µ â€œæ¥å—è€…â€ éƒ½ä¸ä¼šå°¿ä½ ï¼Œç›´æ¥æ‹’ç»ã€‚
4. ä¸Šé¢ 2ï¼‰ä¸­è®²åˆ°ï¼Œå¦‚æœ â€œæè®®è€…â€ åœ¨è´¿é€‰æ—¶ï¼Œå‘ç°å‰é¢å·²ç»æœ‰æ„è§é¢†è¢–çš„æè®®ï¼Œé‚£å°±å°†è‡ªå·±çš„æè®®é»˜é»˜æ”¹æˆå‰é¢æ„è§é¢†è¢–çš„æè®®ã€‚è¿™é‡Œæœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœä½ æ˜¯ â€œæè®®è€…â€ï¼Œåœ¨è´¿èµ‚çš„æ—¶å€™ï¼Œâ€œæ¥å—è€… 1â€ è·Ÿä½ è¯´ â€œä»–è§è¿‡çš„æ„è§é¢†è¢–çš„æè®®æ˜¯æ–¹æ¡ˆ 1â€ï¼Œè€Œâ€œæ¥å—è€… 2â€ è·Ÿä½ è¯´ â€œä»–è§è¿‡çš„æ„è§é¢†è¢–æè®®æ˜¯æ–¹æ¡ˆ 2â€ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿè¿™æ—¶çš„åŸåˆ™ä¹Ÿå¾ˆç®€å•ï¼Œè¿˜æ˜¯ï¼šé’±çš„å¤šå°‘å¾ˆé‡è¦ï¼ä½ åˆ¤æ–­ä¸€ä¸‹æ˜¯â€œæ¥å—è€… 1â€ è§è¿‡çš„æ„è§é¢†è¢–æœ‰é’±ï¼Œè¿˜æ˜¯ â€œæ¥å—è€… 2â€ è§è¿‡çš„æ„è§é¢†è¢–æœ‰é’±ï¼Ÿå¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿå› ä¸º â€œæ¥å—è€…â€ åœ¨è¢« â€œæè®®è€…â€ è´¿èµ‚çš„æ—¶å€™ï¼Œè‡ªå·±ä¼šè®°ä¸‹è´¿èµ‚çš„é‡‘é¢ã€‚æ‰€ä»¥å½“ä½ è´¿èµ‚ â€œæ¥å—è€…â€ æ—¶ï¼Œä¸€æ—¦ä½ ç»™çš„è´¿èµ‚å¤šè€Œèƒœå‡ºï¼Œâ€œæ¥å—è€…â€ä¼šå‘Šè¯‰ä½ ä¸¤ä»¶äº‹æƒ…ï¼ša. å‰ä»»æ„è§é¢†è¢–çš„æè®®å†…å®¹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œb. å‰ä»»æ„è§é¢†è¢–å½“æ—¶è´¿èµ‚äº†å¤šå°‘é’±ã€‚è¿™æ ·ï¼Œå†é¢å¯¹åˆšæ‰çš„æƒ…æ™¯æ—¶ï¼Œä½ åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹ â€œæ¥å—è€… 1â€ å’Œâ€œæ¥å—è€… 2â€å‘Šè¯‰ä½ çš„ä¿¡æ¯ä¸­ï¼Œå“ªä¸ªæ„è§é¢†è¢–å½“æ—¶ç»™çš„é’±å¤šï¼Œé‚£ä½ å°±é»˜é»˜çš„æŠŠè‡ªå·±çš„æè®®ï¼Œæ”¹æˆé‚£ä¸ªæ„è§é¢†è¢–çš„æè®®ã€‚
5. æœ€åè¿™ä¸€éƒ¨åˆ†æœ€æœ‰æ„æ€ï¼Œä½†æè¿°èµ·æ¥æœ‰ç‚¹ç»•ï¼Œå¦‚æœä¸èƒ½ä¸€ä¸‹å­å°±ç†è§£å¯ä»¥å…ˆçœ‹åé¢çš„ä¾‹å­ã€‚åœ¨æ•´ä¸ªé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªäººè°å…ˆæ¥è°ååˆ°ï¼Œâ€œæ¥å—è€…â€ä»€ä¹ˆæ—¶é—´èƒ½å¤Ÿæ¥åˆ° â€œæè®®è€…â€ çš„ä¿¡æ¯ï¼Œæ˜¯å®Œå…¨ä¸å¯æ§çš„ã€‚æ‰€ä»¥å¾ˆå¯èƒ½ä¸€ä¸ªæ„è§é¢†è¢–å·²ç»äº§ç”Ÿäº†ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªæ„è§é¢†è¢–çš„ç¬¬äºŒé˜¶æ®µåˆšåˆšå¼€å§‹ï¼Œç»å¤§éƒ¨åˆ† â€œæ¥å—è€…â€ è¿˜æ²¡æœ‰æ”¶åˆ°è¿™ä¸ªæ„è§é¢†è¢–çš„æè®®ã€‚ç»“æœï¼Œè¿™æ—¶çªç„¶å†²è¿›æ¥äº†ä¸€ä¸ªæ–°çš„åœŸè±ª â€œæè®®è€…â€ï¼Œé‚£ä¹ˆè¿™ä¸ªåœŸè±ªâ€œæè®®è€…â€ ä¹Ÿæ˜¯æœ‰æœºä¼šè®©è‡ªå·±çš„æè®®èƒœå‡ºçš„ï¼**è¿™æ—¶å°±å½¢æˆäº†ä¸€ç§åšå¼ˆï¼š**a. ä¸Šä¸€ä¸ªæ„è§é¢†è¢–è¦èµ¶åœ¨åœŸè±ª â€œæè®®è€…â€ è´¿èµ‚åˆ° â€œæ¥å—è€…â€ å‰ï¼Œèµ¶åˆ° â€œæ¥å—è€…â€ é¢å‰è®©ä»–æ¥å—è‡ªå·±çš„æè®®ï¼Œå¦åˆ™ä¼šå› ä¸ºè‡ªå·±çš„ä¹‹å‰è´¿èµ‚çš„é’±æ¯”åœŸè±ªå°‘è€Œè¢«æ‹’ç»ã€‚b. åœŸè±ª â€œæè®®è€…â€ è¦èµ¶åœ¨ä¸Šä¸€ä¸ªæ„è§é¢†è¢–å°†æè®®ä¼ è¾¾ç»™ â€œæ¥å—è€…â€ å‰ï¼Œè´¿èµ‚åˆ° â€œæ¥å—è€…â€ï¼Œå¦åˆ™åœŸè±ªâ€œæè®®è€…â€ å³ä¾¿è´¿èµ‚æˆåŠŸï¼Œä¹Ÿè¦é»˜é»˜çš„å°†è‡ªå·±çš„æè®®æ”¹ä¸ºå‰ä»»æ„è§é¢†è¢–çš„æè®®ã€‚è¿™æ•´ä¸ªåšå¼ˆçš„è¿‡ç¨‹ï¼Œæœ€ç»ˆå°±çœ‹è¿™ä¸¤ä¸ª â€œæè®®è€…â€ è°çš„è¿›å±•å¿«äº†ã€‚ä½†æœ€ç»ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªæ„è§é¢†è¢–ï¼Œå…ˆå¾—åˆ°å¤šæ•° â€œæ¥å—è€…â€ çš„è®¤å¯ï¼Œé‚£ä»–çš„æè®®å°±èƒœå‡ºäº†ã€‚

æ€»ç»“å¥½å•¦ï¼Œæ•…äº‹åˆ°è¿™é‡ŒåŸºæœ¬è®²è¿°å®Œäº†ï¼Œå’±ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å® Paxos ç®—æ³•å°±ä¸‹é¢è¿™ä¹ˆå‡ ä¸ªåŸåˆ™ï¼š

- Paxos ç®—æ³•åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µä¸»è¦æ˜¯è´¿é€‰ï¼Œè¿˜æ²¡æœ‰æå‡ºæè®®ï¼›ç¬¬äºŒä¸ªé˜¶æ®µä¸»è¦æ ¹æ®ç¬¬ä¸€é˜¶æ®µçš„ç»“æœï¼Œæ˜ç¡®æ¥å—è°çš„æè®®ï¼Œå¹¶æ˜ç¡®æè®®çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼ˆè¿™ä¸ªæè®®å¯èƒ½æ˜¯è´¿é€‰èƒœå‡º â€œæè®®è€…â€ è‡ªå·±çš„æè®®ï¼Œä¹Ÿå¯èƒ½æ˜¯å‰ä»»æ„è§é¢†è¢–çš„æè®®ï¼Œå…·ä½“æ˜¯å“ªä¸ªæè®®ï¼Œè§ä¸‹é¢ç¬¬ 3 ç‚¹åŸåˆ™ï¼‰ã€‚
- ç¼–å·ï¼ˆè´¿èµ‚é‡‘é¢ï¼‰å¾ˆé‡è¦ï¼Œæ— è®ºåœ¨å“ªä¸ªé˜¶æ®µï¼Œç¼–å·ï¼ˆè´¿èµ‚é‡‘é¢ï¼‰å°çš„ï¼Œéƒ½ä¼šè¢«é„™è§†ï¼ˆè¢«æ‹’ç»ï¼‰ã€‚
- åœ¨ç¬¬ä¸€é˜¶æ®µä¸­ï¼Œä¸€æ—¦ â€œæ¥å—è€…â€ å·²ç»æ¥å—äº†ä¹‹å‰æ„è§é¢†è¢–çš„æè®®ï¼Œé‚£åé¢å†æ¥æ‰¾è¿™ä¸ª â€œæ¥å—è€…â€ çš„â€œæè®®è€…â€ï¼Œå³ä¾¿åœ¨è´¿èµ‚ä¸­èƒœå‡ºï¼Œä¹Ÿè¦è¢«æ´—è„‘ï¼Œé»˜é»˜å°†è‡ªå·±çš„æè®®æ”¹ä¸ºå‰ä»»æ„è§é¢†è¢–çš„æè®®ï¼Œç„¶åä»–ä¼šåœ¨ç¬¬äºŒé˜¶æ®µæå‡ºè¯¥æè®®ï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰æ„è§é¢†è¢–çš„æè®®ï¼Œä»¥åŠ›äº‰è®©å¤§å®¶çš„æ„è§è¶‹åŒï¼‰ã€‚å¦‚æœ â€œæ¥å—è€…â€ ä¹‹å‰æ²¡æœ‰æ¥å—è¿‡ä»»ä½•æè®®ï¼Œé‚£è´¿é€‰èƒœå‡ºçš„ â€œæè®®è€…â€ å°±å¯ä»¥æå‡ºè‡ªå·±çš„æè®®äº†ã€‚

### çº¦æŸæ¡ä»¶

- æ­£ç¡®æ€§
    

    æŒ‡åªæœ‰ä¸€ä¸ªæè®®å€¼ä¼šç”Ÿæ•ˆã€‚

    

    å› ä¸º Paxos åè®®è¦æ±‚æ¯ä¸ªç”Ÿæ•ˆçš„æè®®è¢«å¤šæ•° Acceptor æ¥æ”¶ï¼Œå¹¶ä¸” Acceptor ä¸ä¼šæ¥å—ä¸¤ä¸ªä¸åŒçš„æè®®ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ­£ç¡®æ€§ã€‚

    
- å¯ç»ˆæ­¢æ€§
    

    æŒ‡æœ€åæ€»ä¼šæœ‰ä¸€ä¸ªæè®®ç”Ÿæ•ˆã€‚

    

    Paxos åè®®èƒ½å¤Ÿè®© Proposer å‘é€çš„æè®®æœç€èƒ½è¢«å¤§å¤šæ•° Acceptor æ¥å—çš„é‚£ä¸ªæè®®é æ‹¢ï¼Œå› æ­¤èƒ½å¤Ÿä¿è¯å¯ç»ˆæ­¢æ€§ã€‚

    

## Raft

Raft ä¹Ÿæ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ï¼Œä¸»è¦æ˜¯ç”¨æ¥ç«é€‰ä¸»èŠ‚ç‚¹ã€‚

[Raft: Understandable Distributed Consensus](http://thesecretlivesofdata.com/raft)

### å•ä¸ª Candidate çš„ç«é€‰

æœ‰ä¸‰ç§èŠ‚ç‚¹ï¼šFollowerã€Candidate å’Œ Leaderã€‚Leader ä¼šå‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åŒ…ç»™ Followerã€‚æ¯ä¸ª Follower éƒ½è®¾ç½®äº†ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸º 150ms~300msï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šå˜æˆ Candidateï¼Œè¿›å…¥ç«é€‰é˜¶æ®µã€‚

- ä¸‹å›¾å±•ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€åˆé˜¶æ®µï¼Œæ­¤æ—¶åªæœ‰ Follower æ²¡æœ‰ Leaderã€‚Node A ç­‰å¾…ä¸€ä¸ªéšæœºçš„ç«é€‰è¶…æ—¶æ—¶é—´ä¹‹åï¼Œæ²¡æ”¶åˆ° Leader å‘æ¥çš„å¿ƒè·³åŒ…ï¼Œå› æ­¤è¿›å…¥ç«é€‰é˜¶æ®µã€‚

![705ef0ec-1625-457a-b20e-50e09ffe02e7.gif](https://s3.665210.xyz/pictures/Notion/programmer/705ef0ec-1625-457a-b20e-50e09ffe02e7.gif)

- æ­¤æ—¶ Node A å‘é€æŠ•ç¥¨è¯·æ±‚ç»™å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚

![29249ec2-30f1-4413-b7d4-059cbb432d9e.gif](https://s3.665210.xyz/pictures/Notion/programmer/29249ec2-30f1-4413-b7d4-059cbb432d9e.gif)

- å…¶å®ƒèŠ‚ç‚¹ä¼šå¯¹è¯·æ±‚è¿›è¡Œå›å¤ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹å›å¤äº†ï¼Œé‚£ä¹ˆè¯¥ Candidate å°±ä¼šå˜æˆ Leaderã€‚

![c29d0408-12ef-4443-8452-0554d3386fbd.gif](https://s3.665210.xyz/pictures/Notion/programmer/c29d0408-12ef-4443-8452-0554d3386fbd.gif)

- ä¹‹å Leader ä¼šå‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³åŒ…ç»™ Followerï¼ŒFollower æ¥æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚

![13f630cb-7b80-4476-9fc5-358d12df2b81.gif](https://s3.665210.xyz/pictures/Notion/programmer/13f630cb-7b80-4476-9fc5-358d12df2b81.gif)

### å¤šä¸ª Candidate ç«é€‰

- å¦‚æœæœ‰å¤šä¸ª Follower æˆä¸º Candidateï¼Œå¹¶ä¸”æ‰€è·å¾—ç¥¨æ•°ç›¸åŒï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ Node B å’Œ Node D éƒ½è·å¾—ä¸¤ç¥¨ï¼Œéœ€è¦é‡æ–°å¼€å§‹æŠ•ç¥¨ã€‚

![1e09b60d-5454-4c21-bb14-1d6a88c5595b.gif](https://s3.665210.xyz/pictures/Notion/programmer/1e09b60d-5454-4c21-bb14-1d6a88c5595b.gif)

- ç”±äºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®çš„éšæœºç«é€‰è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå› æ­¤ä¸‹ä¸€æ¬¡å†æ¬¡å‡ºç°å¤šä¸ª Candidate å¹¶è·å¾—åŒæ ·ç¥¨æ•°çš„æ¦‚ç‡å¾ˆä½ã€‚

![8600d674-180e-490f-a290-498f6e570aa6.gif](https://s3.665210.xyz/pictures/Notion/programmer/8600d674-180e-490f-a290-498f6e570aa6.gif)

### æ•°æ®åŒæ­¥

- æ¥è‡ªå®¢æˆ·ç«¯çš„ä¿®æ”¹éƒ½ä¼šè¢«ä¼ å…¥ Leaderã€‚æ³¨æ„è¯¥ä¿®æ”¹è¿˜æœªè¢«æäº¤ï¼Œåªæ˜¯å†™å…¥æ—¥å¿—ä¸­ã€‚

![ee420454-4e31-4fa3-86a2-0184488832bb.gif](https://s3.665210.xyz/pictures/Notion/programmer/ee420454-4e31-4fa3-86a2-0184488832bb.gif)

- Leader ä¼šæŠŠä¿®æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ Followerã€‚

![4674b165-e23e-4638-93d4-83e219666b5a.gif](https://s3.665210.xyz/pictures/Notion/programmer/4674b165-e23e-4638-93d4-83e219666b5a.gif)

- Leader ä¼šç­‰å¾…å¤§å¤šæ•°çš„ Follower ä¹Ÿè¿›è¡Œäº†ä¿®æ”¹ï¼Œç„¶åæ‰å°†ä¿®æ”¹æäº¤ã€‚

![fc373cea-ce7d-4b72-b871-a43c70ccb309.gif](https://s3.665210.xyz/pictures/Notion/programmer/fc373cea-ce7d-4b72-b871-a43c70ccb309.gif)

- æ­¤æ—¶ Leader ä¼šé€šçŸ¥çš„æ‰€æœ‰ Follower è®©å®ƒä»¬ä¹Ÿæäº¤ä¿®æ”¹ï¼Œæ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹çš„å€¼è¾¾æˆä¸€è‡´ã€‚

![b0667324-2de6-4876-a8ad-ba6c64bfc904.gif](https://s3.665210.xyz/pictures/Notion/programmer/b0667324-2de6-4876-a8ad-ba6c64bfc904.gif)

## PoWï¼ˆProof of Workï¼‰å·¥ä½œé‡è¯æ˜

ä»¥ä¸Šçš„ç®—æ³•éƒ½æ˜¯å‡è®¾ä¸å­˜åœ¨æ‹œå åº­å°†å†›é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„é—®é¢˜ã€‚

ä½†æ˜¯åœ¨æ¯”ç‰¹å¸çš„ç³»ç»Ÿä¸­ï¼Œä¸åƒç³»ç»Ÿå†…éƒ¨å¯ä»¥ç¡®è®¤èŠ‚ç‚¹ä¸ä¼šå‘å‡ºæ¶æ„çš„æŠ•ç¥¨ï¼Œæ¯”ç‰¹å¸ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸å¯é çš„ï¼Œæ‰€ä»¥æ¯”ç‰¹å¸ä½¿ç”¨PoWæ¥è§£å†³å…±è¯†é—®é¢˜ã€‚

Powçš„æ ¸å¿ƒæ˜¯ï¼š

- å¢åŠ æŠ•ç¥¨çš„æˆæœ¬ï¼Œé™åˆ¶åŒä¸€æ—¶é—´å†…äº§ç”Ÿçš„ææ¡ˆæ•°é‡ï¼ˆéœ€è¦å¤§é‡ç®—åŠ›æŒ–çŸ¿ï¼‰ï¼›
- æ”¾å®½å¯¹æœ€ç»ˆä¸€è‡´æ€§ç¡®è®¤çš„éœ€æ±‚ï¼Œå¤§å®¶å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªææ¡ˆï¼ˆç”±äºææ¡ˆæˆæœ¬é«˜ï¼Œå¤§å®¶ä¹Ÿåªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼‰ï¼Œæœ€ç»ˆæ”¯æŒæ¯”è¾ƒå°‘çš„ææ¡ˆï¼ˆè¾ƒçŸ­çš„é“¾è·¯ï¼‰æœ€ç»ˆä¼šè¢«åºŸå¼ƒ

åŒæ—¶ï¼Œç”±äºäº§ç”Ÿææ¡ˆçš„æˆæœ¬å¾ˆé«˜ï¼Œä¼ªé€ ææ¡ˆå‡ ä¹å˜å¾—ä¸å¯èƒ½ã€‚å…³äºæŒ–çŸ¿å’Œéš¾åº¦å‚è€ƒ [[02Area/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»/åŒºå—é“¾æŠ€æœ¯å’Œæ¯”ç‰¹å¸\|åŒºå—é“¾æŠ€æœ¯å’Œæ¯”ç‰¹å¸]]

â½ç‰¹å¸çš„æŒ–çŸ¿ç®—æ³•å¹¶ä¸æ˜¯â½ç‰¹å¸å¼€åˆ›çš„ï¼Œå…¶åŸå‹å« Hashcashï¼Œèµ·åˆå‘æ˜çš„åŸå› æ˜¯ä¸ºäº†è§£å†³åƒåœ¾é‚®ä»¶çš„é—®é¢˜ï¼Œè¦æ±‚é‚®ä»¶å‘é€æ–¹ï¼Œå°†é‚®ä»¶å¤´ä¿¡æ¯äº§ç”Ÿä¸€ä¸ªå¼€å¤´æœ‰5ä¸ª0çš„sha-1 hashå€¼ã€‚è¿™å¯¹å‘é€æ–¹æ¥è¯´æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯å¯¹éœ€è¦å‘é€å¤§é‡åƒåœ¾é‚®ä»¶çš„äººæ¥è¯´ï¼Œæˆæœ¬å°±æœ‰ç‚¹é«˜ã€‚

## PoS ï¼ˆProof of Stakeï¼‰è‚¡æƒè¯æ˜åè®®

Powçš„æœºåˆ¶ï¼Œåœ¨æ¯”ç‰¹å¸ä¸­ï¼Œéšç€ç®—åŠ›çš„æå‡è¶Šæ¥è¶Šéš¾ï¼Œå¯¹ç”µåŠ›èµ„æºæµªè´¹ä¸¥é‡ï¼Œä¸ºäº†æ¯ä¸ªBlockæ›´å¿«çš„ç”Ÿæˆï¼Œäº§ç”Ÿäº†Posåè®®ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºè‚¡æƒè¯æ˜åè®®ã€‚

åœ¨PoSæœºåˆ¶ä¸‹ï¼ŒçŸ¿â¼¯ä¸å†å«çŸ¿â¼¯ï¼Œâ½½æ˜¯å«Validatorï¼ˆæ ¡éªŒè€…ï¼‰ã€‚å‡è®¾ç°åœ¨æœ‰â¼€ä¸ªåŒºåŸŸéœ€è¦è¢«â½£æˆï¼Œâ½½ç°åœ¨æœ‰4ä¸ªValidatorï¼Œæ¯â¼€ä¸ªValidatoréœ€è¦ä»¥"äº¤æŠ¼â¾¦"çš„â½…å¼æ¥å–å¾—è®°è´¦æƒã€‚å‡å¦‚ï¼ŒAäº¤çš„æŠ¼â¾¦å äº†38%ï¼ŒBå 25%ï¼ŒCç‚¹21%ï¼ŒDå 16%ã€‚é‚£ä¹ˆï¼Œä»–ä»¬æŒ‰ç…§è‚¡æƒçš„â½æƒæ¥è·å¾—è®°è´¦æƒã€‚â½å¦‚ï¼ŒAæœ‰38%çš„æ¦‚ç‡å¯ä»¥è·å¾—è®°è´¦æƒï¼ˆä¸æ˜¯ç”±ç³»ç»Ÿéšæœºåˆ†é…ï¼Œè¿˜æ˜¯è¦ç®—hashå€¼ï¼Œåªä¸è¿‡æ˜¯è´¢å¯Œè¶Šå¤šçš„â¼ˆæŒ–çŸ¿çš„éš¾åº¦è¶Šâ¼©ï¼‰ã€‚â½½å¦‚æœä½ å‘èµ·æ¶æ„æ”»å‡»çš„è¯ï¼Œä½ çš„é’±å°±ä¼šè¢«ç³»ç»Ÿæ²¡æ”¶å……å…¬ã€‚â½½Validatorè®°è´¦åæ²¡æœ‰å¥–â¾¦ï¼Œåªæœ‰â¼¿ç»­è´¹ã€‚  
ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨PoSæœºåˆ¶ä¸‹ï¼Œè®°è´¦æƒä¸å†åƒPoWé‚£æ ·ç”±è°çš„ç®—â¼’â¼¤è°å°±è¶Šæœ‰æœºä¼šæ¥è®°è´¦ï¼Œâ½½æ˜¯ç”±è°çš„è´¢å¯Œå¤šï¼Œè°å°±è¶Šæœ‰å¯èƒ½æ¥è®°è´¦ã€‚äºæ˜¯ï¼Œè®°è´¦æƒæŒ‰â¼¤å®¶è´¢å¯Œçš„â½ä¾‹æ¥åˆ†é…ã€‚  

**PoWå¥½åƒæ˜¯"å¤šåŠ³å¤šå¾—"çš„ç¤¾ä¼šï¼Œâ½½PoSæ›´åƒæ˜¯"èµ„æœ¬ä¸»ä¹‰"ç¤¾ä¼šï¼Œé’±è¶Šå¤šçš„â¼ˆè¶Šæœ‰è¯è¯­æƒã€‚è¿™å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¯¹çš„ã€‚ä»åšå¼ˆè®ºçš„â»†åº¦ä¸Šæ¥è¯´ï¼Œé’±è¶Šå¤šçš„â¼ˆè¶Šæœ‰åŠ¨â¼’ç»´æŠ¤ç¤¾ä¼šçš„ç¨³å®šï¼Œå› ä¸ºå¦‚æœç¤¾ä¼šä¸ç¨³å®šäº†ï¼Œä»–æ˜¯æŸå¤±æœ€ä¸ºæƒ¨é‡çš„â¼ˆ**ã€‚

ï¼ˆè¿™â¾¥æœ‰â¼€ä¸ªé€»è¾‘é—®é¢˜ï¼šå¦‚æœé’±è¶Šå¤šçš„â¼ˆè¶Šæœ‰åŠ¨â¼’ç»´æŠ¤ç¤¾ä¼šç¨³å®šï¼Œé‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯ä¸­â¼¼åŒ–çš„æœºæ„ä¹Ÿè¶Šæœ‰åŠ¨â¼’ç»´æŠ¤æ•´ä¸ªç³»ç»Ÿçš„å¥åº·åº¦ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å»ä¸­â¼¼åŒ–å‘¢ï¼Ÿï¼‰  
åœ¨ä»¥å¤ªåŠä¸‹ï¼Œæ˜¯æ ¹æ®æ‹¥æœ‰ä»¥å¤ªå¸çš„æ€»é‡ï¼Œæ¥å†³å®šæˆä¸ºValidatorçš„æœºç‡ã€‚  

PoSçš„ä¼˜ç‚¹

- ä¸éœ€è¦è€—è´¹å¤§é‡ç”µåŠ›æŒ–çŸ¿äº†
- Powçš„æœºåˆ¶ä¸‹ï¼Œç°åœ¨ç®—åŠ›è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œä¸æ˜¯æ™®é€šäººèƒ½å‚ä¸äº†ï¼Œå‡ å®¶å¤§å…¬å¸åˆä½œèµ·æ¥ï¼Œå°±èƒ½æ»¡è¶³è¶…è¿‡50%çš„ç®—åŠ›ï¼Œå°±å¯ä»¥ä½œå¼Šäº†ï¼Œè¿™æ˜¯ä¸æ˜¯è¿èƒŒäº†å»ä¸­å¿ƒåŒ–çš„æ€æƒ³ï¼Ÿè€Œåœ¨Posä¸‹ï¼Œä½ éœ€è¦æ‹¥æœ‰50%ä»¥ä¸Šè´¢å¯Œæ‰èƒ½ä½œå¼Šï¼Œä½ ä½œå¼Šäº†ï¼Œè¢«å‘ç°ï¼Œé’±è¢«æ²¡æ”¶ï¼Œä½œå¼Šçš„æ„ä¹‰å°±æ²¡æœ‰äº†ã€‚

PoSçš„ç¼ºç‚¹

- è®°è´¦æˆæœ¬ä½äº†ï¼Œåœ¨PoWä¸­ï¼Œå¦‚æœå‡ºç°äº†ä¸€ä¸ªåˆ†å‰ï¼ŒçŸ¿å·¥ç”±äºç®—åŠ›æœ‰é™ï¼Œæ™ºèƒ½èµŒé€‰æ‹©å…¶ä¸­ä¸€ä¸ªåˆ†å‰ï¼Œè§£å†³äº†ä¸€è‡´æ€§é—®é¢˜ï¼Œä½†æ˜¯åœ¨PoSä¸­ï¼Œå¯ä»¥è·Ÿè¸ªå¤šä¸ªåˆ†å‰ï¼Œå¯¼è‡´å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜

ä¸ºäº†è§£å†³åˆ†å‰äº§ç”Ÿçš„æ”»å‡»é—®é¢˜ï¼Œæœ‰äººåˆæå‡ºæ¥DPoSã€‚

## DPoSï¼ˆDelegated Proof ofStakeï¼‰å§”æ‰˜è‚¡æƒè¯æ˜æœºåˆ¶

åœ¨å¸¸è§„PoWå’ŒPoSä¸­ï¼Œâ¼€â¼¤å½±å“æ•ˆç‡ä¹‹å¤„åœ¨äºä»»ä½•â¼€ä¸ªæ–°åŠ â¼Šçš„åŒºå—ï¼Œéƒ½éœ€è¦è¢«æ•´ä¸ªâ½¹ç»œæ‰€æœ‰èŠ‚ç‚¹åšç¡®è®¤ã€‚DPoSä¼˜åŒ–â½…æ¡ˆåœ¨äºï¼šé€šè¿‡ä¸åŒçš„ç­–ç•¥ï¼Œä¸å®šæ—¶åœ°é€‰ä¸­â¼€â¼©ç¾¤èŠ‚ç‚¹ï¼Œè¿™â¼€â¼©ç¾¤èŠ‚ç‚¹åšæ–°åŒºå—çš„åˆ›å»ºã€éªŒè¯ã€ç­¾åå’Œç›¸äº’ç›‘ç£ã€‚è¿™æ ·å°±â¼¤å¹…åº¦å‡å°‘äº†åŒºå—åˆ›å»ºå’Œç¡®è®¤æ‰€éœ€è¦æ¶ˆè€—çš„æ—¶é—´å’Œç®—â¼’æˆæœ¬ã€‚åŒæ—¶ä¹Ÿå¯ä»¥é¿å…åˆ†å‰äº†ã€‚

DPoSä¸‹æ¯ä¸ªtokenéƒ½æ˜¯é€‰ç¥¨ï¼Œâ¼¤å®¶ç¥¨é€‰20ä¸ªé€‰ä¸¾â¼ˆå›¢+1ä¸ªéšæœºé€‰ä¸¾â¼ˆ=21ä¸ªé€‰ä¸¾â¼ˆä»£è¡¨â½¹ç»œã€‚ç„¶åæ¯éš”â¼€æ®µæ—¶é—´ï¼Œåœ¨è¿™21ä¸ªâ¼ˆä¸­æŒ‘é€‰â¼€ä¸ªå‡ºæ¥ç»´æŠ¤è´¦æœ¬å¹¶è·å¾—æ”¶ç›Šã€‚

> [!important]  
> èµ°ä¸Šäº†ä¸­å¿ƒåŒ–çš„è€è·¯ã€‚ã€‚ã€‚ã€‚  

# æ€»ç»“

TODO: Kafkaçš„äº‹åŠ¡

ä¸åŒç®—æ³•å¯¹CAPåŸåˆ™çš„å®ç°å¦‚å›¾

![assets/Untitled 4 8.png|Untitled 4 8.png](https://s3.665210.xyz/pictures/Notion/programmer/assets/Untitled 4 8.png|Untitled 4%208.png)

é€šå¸¸ï¼Œåœ¨åº”ç”¨å±‚å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåªèƒ½ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼›æ•°æ®å±‚æ¨èä½¿ç”¨Paxosã€‚

# å‚è€ƒ

- [[distrib\|distrib]]
- [åˆ†å¸ƒå¼ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†](https://coolshell.cn/articles/10910.html)
- [æ·±å…¥ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡](https://juejin.im/entry/577c6f220a2b5800573492be)
- [What is CAP theorem in distributed database system?](http://www.colooshiki.com/index.php/2017/04/20/what-is-cap-theorem-in-distributed-database-system/)
- [NEAT ALGORITHMS - PAXOS](http://harry.me/blog/2014/12/27/neat-algorithms-paxos/)
- [Paxos By Example](https://angus.nyc/2012/paxos-by-example/)
